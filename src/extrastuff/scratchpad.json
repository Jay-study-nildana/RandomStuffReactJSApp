//this code borrowed from the project randomstuff1
//in the LearningReactNode repository.

//this page makes an api call and collects a random quote
//it also has a counter that shows how many quotes were collected.

import React, { useEffect } from "react";
  import { useState } from "react";
  import GoHome from "../components/GoHome";
  
  const SimpleButton = (
      {
          ApiFunction1 = f => f,
      }
      ) => (
          <div>
              <button onClick = {ApiFunction1}> API Button</button>
          </div>
  
          
      );   
  
  const url2 = "https://randomstuffgeneratorsep23.azurewebsites.net/api/RandomQuotes/GetHoldOfthem";   
  
  
  function APICall() {
  const [apimessage1,setapimessage1] = useState("api status will come here");
  
  //these are api related.
  const [data, setData] = useState();
  const [error, setError] = useState();
  const [loading, setLoading] = useState(false);
  const [counter,setcounter] = useState(1);
  
  useEffect( () => {
  
      if(loading)
      {
          setapimessage1("api is now loading");
          setData("-");
      }
      else
      {
          setapimessage1("api has finished to completion");
          setcounter(counter + 1);
      }
  
  },[loading]);
  
  function ApiCallStuff()
  {
      setLoading(true);
      fetch(url2,
          {
              method:"GET"
          }
      ).then(data => data.json())
      .then(setData)
      .then( () => setLoading(false) )
      .catch(setError);
  }
  
  //a component to display the json contents.
  function DisplayJSONData(
      {
          data
      }
  )
  {
      if(!data) return <div>
          <p>JSON does not have any data yet.</p>
          <p>click on API to send data</p>
      </div>
      return <div>
          <p>{data.quoteTitle}</p>
          <p>{data.quoteContent}</p>
      </div>
  }
  
      return (
          <div>
              <hr></hr>
              <SimpleButton
                  ApiFunction1 = {
                      () => {
                          ApiCallStuff();
                      }
                  }                                
              />
              <p>{apimessage1}</p>
              {/* <p>api data will come below </p>
              <p>{ JSON.stringify(data,null,2)}</p> */}
              <p>{JSON.stringify(error, null, 2)}</p>
              <p>quotes read {counter}</p>
              <DisplayJSONData data = {data}/>
              <GoHome />
          </div>
      );
  }
  
  export default APICall;